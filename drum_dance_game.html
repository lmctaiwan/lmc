<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>打鼓跳舞機遊戲</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .game-container {
            width: 800px;
            height: 600px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .header {
            padding: 20px;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px 20px 0 0;
        }

        .score-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .score, .combo {
            font-size: 24px;
            font-weight: bold;
        }

        .combo {
            color: #ff6b35;
        }

        .game-area {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .track {
            position: absolute;
            top: 0;
            bottom: 120px;
            width: 150px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        .track.left { left: 100px; background: rgba(255, 100, 100, 0.2); }
        .track.up { left: 250px; background: rgba(100, 255, 100, 0.2); }
        .track.down { left: 400px; background: rgba(100, 100, 255, 0.2); }
        .track.right { left: 550px; background: rgba(255, 255, 100, 0.2); }

        .note {
            position: absolute;
            width: 120px;
            height: 60px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: fall linear;
            left: 15px;
        }

        .note.left { background: linear-gradient(45deg, #ff6b6b, #ff8e8e); }
        .note.up { background: linear-gradient(45deg, #4ecdc4, #7fdbda); }
        .note.down { background: linear-gradient(45deg, #45b7d1, #6bb6ff); }
        .note.right { background: linear-gradient(45deg, #f9ca24, #f0932b); }

        @keyframes fall {
            from { top: -60px; }
            to { top: 480px; }
        }

        .hit-zone {
            position: absolute;
            bottom: 120px;
            width: 150px;
            height: 80px;
            border: 4px solid #fff;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.1s;
        }

        .hit-zone.left { left: 100px; }
        .hit-zone.up { left: 250px; }
        .hit-zone.down { left: 400px; }
        .hit-zone.right { left: 550px; }

        .hit-zone.active {
            background: rgba(255, 255, 255, 0.6);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
        }

        .controls {
            padding: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0 0 20px 20px;
        }

        .btn {
            padding: 12px 24px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .hit-effect {
            position: absolute;
            pointer-events: none;
            color: #fff;
            font-size: 32px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            animation: hitEffect 0.8s ease-out forwards;
        }

        @keyframes hitEffect {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(1.5) translateY(-50px); }
        }

        .perfect { color: #ffd700; }
        .good { color: #4ecdc4; }
        .miss { color: #ff6b6b; }

        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
        }

        .game-over h2 {
            font-size: 48px;
            margin-bottom: 20px;
            color: #ffd700;
        }

        .final-score {
            font-size: 32px;
            margin-bottom: 30px;
        }

        .instructions {
            text-align: center;
            margin-bottom: 20px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <div class="score-display">
                <div class="score">分數: <span id="score">0</span></div>
                <div class="combo">連擊: <span id="combo">0</span></div>
            </div>
            <div class="instructions">
                使用 A、S、D、F 鍵或點擊按鈕來打鼓！
            </div>
        </div>
        
        <div class="game-area">
            <div class="track left"></div>
            <div class="track up"></div>
            <div class="track down"></div>
            <div class="track right"></div>
            
            <div class="hit-zone left">A</div>
            <div class="hit-zone up">S</div>
            <div class="hit-zone down">D</div>
            <div class="hit-zone right">F</div>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="startGame()" id="startBtn">開始遊戲</button>
            <button class="btn" onclick="pauseGame()" id="pauseBtn" disabled>暫停</button>
            <button class="btn" onclick="resetGame()">重新開始</button>
        </div>
        
        <div class="game-over" id="gameOver">
            <h2>遊戲結束！</h2>
            <div class="final-score">最終分數: <span id="finalScore">0</span></div>
            <button class="btn" onclick="resetGame()">再玩一次</button>
        </div>
    </div>

    <script>
        let gameState = {
            isPlaying: false,
            isPaused: false,
            score: 0,
            combo: 0,
            maxCombo: 0,
            notes: [],
            noteSpeed: 3,
            spawnRate: 1000,
            lastSpawn: 0
        };

        const tracks = ['left', 'up', 'down', 'right'];
        const keyMap = {
            'KeyA': 'left',
            'KeyS': 'up',
            'KeyD': 'down',
            'KeyF': 'right'
        };

        let gameLoop;
        let spawnInterval;

        function startGame() {
            if (gameState.isPaused) {
                gameState.isPaused = false;
                gameLoop = requestAnimationFrame(update);
                spawnInterval = setInterval(spawnNote, gameState.spawnRate);
                document.getElementById('startBtn').textContent = '開始遊戲';
                document.getElementById('pauseBtn').disabled = false;
                return;
            }

            gameState.isPlaying = true;
            gameState.isPaused = false;
            gameState.score = 0;
            gameState.combo = 0;
            gameState.notes = [];
            
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
            
            updateUI();
            gameLoop = requestAnimationFrame(update);
            spawnInterval = setInterval(spawnNote, gameState.spawnRate);
        }

        function pauseGame() {
            if (!gameState.isPlaying) return;
            
            if (gameState.isPaused) {
                startGame();
            } else {
                gameState.isPaused = true;
                cancelAnimationFrame(gameLoop);
                clearInterval(spawnInterval);
                document.getElementById('startBtn').textContent = '繼續';
                document.getElementById('startBtn').disabled = false;
                document.getElementById('pauseBtn').disabled = true;
            }
        }

        function resetGame() {
            gameState.isPlaying = false;
            gameState.isPaused = false;
            cancelAnimationFrame(gameLoop);
            clearInterval(spawnInterval);
            
            // 清除所有音符
            document.querySelectorAll('.note').forEach(note => note.remove());
            document.querySelectorAll('.hit-effect').forEach(effect => effect.remove());
            
            gameState.score = 0;
            gameState.combo = 0;
            gameState.notes = [];
            
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('startBtn').textContent = '開始遊戲';
            document.getElementById('pauseBtn').disabled = true;
            
            updateUI();
        }

        function spawnNote() {
            if (!gameState.isPlaying || gameState.isPaused) return;
            
            const track = tracks[Math.floor(Math.random() * tracks.length)];
            const note = document.createElement('div');
            note.className = `note ${track}`;
            note.textContent = '🥁';
            
            const trackElement = document.querySelector(`.track.${track}`);
            trackElement.appendChild(note);
            
            gameState.notes.push({
                element: note,
                track: track,
                startTime: Date.now()
            });
        }

        function update() {
            if (!gameState.isPlaying || gameState.isPaused) return;
            
            // 更新音符位置
            gameState.notes.forEach((noteData, index) => {
                const elapsed = Date.now() - noteData.startTime;
                const position = elapsed * gameState.noteSpeed / 10;
                noteData.element.style.top = position + 'px';
                
                // 檢查是否超出螢幕
                if (position > 540) {
                    noteData.element.remove();
                    gameState.notes.splice(index, 1);
                    // 錯失音符，重置連擊
                    gameState.combo = 0;
                    updateUI();
                }
            });
            
            gameLoop = requestAnimationFrame(update);
        }

        function hitNote(track) {
            if (!gameState.isPlaying || gameState.isPaused) return;
            
            const hitZone = document.querySelector(`.hit-zone.${track}`);
            hitZone.classList.add('active');
            setTimeout(() => hitZone.classList.remove('active'), 100);
            
            // 尋找最接近打擊區的音符
            let bestNote = null;
            let bestDistance = Infinity;
            
            gameState.notes.forEach((noteData, index) => {
                if (noteData.track === track) {
                    const noteTop = parseInt(noteData.element.style.top) || 0;
                    const hitZoneTop = 420; // 打擊區的位置
                    const distance = Math.abs(noteTop - hitZoneTop);
                    
                    if (distance < bestDistance && distance < 100) {
                        bestDistance = distance;
                        bestNote = { data: noteData, index: index };
                    }
                }
            });
            
            if (bestNote) {
                // 計算打擊品質
                let hitQuality;
                let points;
                let effectClass;
                
                if (bestDistance < 30) {
                    hitQuality = 'PERFECT!';
                    points = 100;
                    effectClass = 'perfect';
                    gameState.combo++;
                } else if (bestDistance < 60) {
                    hitQuality = 'GOOD!';
                    points = 50;
                    effectClass = 'good';
                    gameState.combo++;
                } else {
                    hitQuality = 'OK';
                    points = 20;
                    effectClass = 'good';
                    gameState.combo++;
                }
                
                // 連擊加分
                const comboBonus = Math.floor(gameState.combo / 10) * 10;
                gameState.score += points + comboBonus;
                
                // 移除音符
                bestNote.data.element.remove();
                gameState.notes.splice(bestNote.index, 1);
                
                // 顯示打擊效果
                showHitEffect(track, hitQuality, effectClass);
                
                updateUI();
            } else {
                // 沒有擊中任何音符，重置連擊
                gameState.combo = 0;
                showHitEffect(track, 'MISS', 'miss');
                updateUI();
            }
        }

        function showHitEffect(track, text, className) {
            const effect = document.createElement('div');
            effect.className = `hit-effect ${className}`;
            effect.textContent = text;
            
            const hitZone = document.querySelector(`.hit-zone.${track}`);
            const rect = hitZone.getBoundingClientRect();
            const container = document.querySelector('.game-container').getBoundingClientRect();
            
            effect.style.left = (rect.left - container.left + rect.width / 2 - 50) + 'px';
            effect.style.top = (rect.top - container.top - 30) + 'px';
            
            document.querySelector('.game-container').appendChild(effect);
            
            setTimeout(() => effect.remove(), 800);
        }

        function updateUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('combo').textContent = gameState.combo;
            
            // 增加難度
            if (gameState.score > 0 && gameState.score % 1000 === 0) {
                gameState.noteSpeed += 0.5;
                gameState.spawnRate = Math.max(400, gameState.spawnRate - 50);
                clearInterval(spawnInterval);
                if (gameState.isPlaying && !gameState.isPaused) {
                    spawnInterval = setInterval(spawnNote, gameState.spawnRate);
                }
            }
        }

        // 鍵盤事件
        document.addEventListener('keydown', (e) => {
            if (keyMap[e.code]) {
                e.preventDefault();
                hitNote(keyMap[e.code]);
            }
        });

        // 添加點擊事件
        document.querySelectorAll('.hit-zone').forEach(zone => {
            zone.addEventListener('click', () => {
                const track = zone.classList[1];
                hitNote(track);
            });
        });

        // 初始化UI
        updateUI();

        // 自動生成一些音符來展示
        function generateDemoNotes() {
            const demoPattern = [
                { track: 'left', delay: 0 },
                { track: 'up', delay: 500 },
                { track: 'down', delay: 1000 },
                { track: 'right', delay: 1500 },
                { track: 'left', delay: 2000 },
                { track: 'right', delay: 2200 },
                { track: 'up', delay: 2700 },
                { track: 'down', delay: 3200 }
            ];
            
            demoPattern.forEach(note => {
                setTimeout(() => {
                    if (!gameState.isPlaying) {
                        const noteElement = document.createElement('div');
                        noteElement.className = `note ${note.track}`;
                        noteElement.textContent = '🥁';
                        noteElement.style.animation = 'fall 4s linear infinite';
                        
                        const trackElement = document.querySelector(`.track.${note.track}`);
                        trackElement.appendChild(noteElement);
                        
                        setTimeout(() => {
                            if (noteElement.parentNode) {
                                noteElement.remove();
                            }
                        }, 4000);
                    }
                }, note.delay);
            });
        }

        // 開始展示模式
        generateDemoNotes();
        setInterval(() => {
            if (!gameState.isPlaying) {
                generateDemoNotes();
            }
        }, 4000);
    </script>
</body>
</html>